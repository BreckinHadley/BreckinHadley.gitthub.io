---
title: "Mapping"
---



```{r, echo = FALSE, message=FALSE}
#Load Packages
library(maps)      
library(sf)        
library(dplyr)
library(leaflet)
library(readr)
library(stringr)
library(htmltools)
library(glue)
library(ggplot2)

# Load in Data
states <- st_as_sf(maps::map("state", plot = FALSE, fill = TRUE))

polution_raw <- read_csv("pollutionDataSheet1.csv")

wildfire_raw <- read_csv("WildFireDataSheet1.csv")
```

---
subtitle: "Data Overview"
---
These choropleth maps use state level data to illustrate pollution (micro grams per cubic) and the second data set looks at the wildfire risk within each US state. The first data set looks at air pollution and particulate matter by state in the year 2020. While the second data set looks at acres burned and number of wildfires in each state in 2023. Both data sets create pretty insightful visualizations that show trends about the data.


**Mircograms per Cubic meter (Pollution) by State:**
```{r, echo = FALSE, message=FALSE, warning=FALSE}

polution_clean <- polution_raw |>
  mutate(state_lower = tolower(State))

state_aqi <- polution_clean |>
  group_by(state_lower) |>
  summarize(mean_value = mean(Pollution, na.rm = TRUE))

states_sf <- st_as_sf(map("state", plot = FALSE, fill = TRUE))

state_plot <- states_sf |>
  left_join(state_aqi, by = c("ID" = "state_lower"))

state_plot <- state_plot |>
  mutate(
    value_intervals = cut(
      mean_value,
      breaks = c(0, 4, 5, 6, 7, 8, 9, 10, 15),
      include.lowest = TRUE
    )
  )

ggplot(data = state_plot) +
  geom_sf(aes(fill = value_intervals), color = "white", linetype = 1) +
  theme_void() +
  scale_fill_brewer(palette = "PuBu", na.value = "grey80") +
  labs(fill = "Micrograms per cubic meter")
```
via the NIH (National Institute on Minority Health and Health Disparities)
Source: [Link](https://hdpulse.nimhd.nih.gov/data-portal/physical/table?age=001&age_options=ageall_1&demo=234&demo_options=air_pollution_1&physicaltopic=002&physicaltopic_options=physical_2&race=00&race_options=raceall_1&sex=0&sex_options=sexboth_1&statefips=00&statefips_options=area_states)

**Insight:**
This plot shows the pollution trends across the continuous United States in the year 2020. The darker colors show states that are more polluted (higher micro grams per meter). While the lighter colors shows tates that are less polluted (lower micro grams per meter). The West Coast definitely has the highest amount of air pollution while Montana and the Dakotas have the least.



**Mircograms per Cubic meter (Pollution) by State: Interactive**
```{r, echo=FALSE, message=FALSE, warning=FALSE}
states <- st_as_sf(map("state", plot = FALSE, fill = TRUE))

# 3) Join pollution data to states map
states <- states |>
  left_join(
    polution_clean |>
      group_by(state_lower) |>
      summarize(mean_pollution = mean(Pollution, na.rm = TRUE)),
    by = c("ID" = "state_lower")
  )

# 4) Create bins and color palette
bins <- c(0, 4, 5, 6, 7, 8, 9, 10, 15)  # adjust based on your data
pal <- colorBin("YlOrRd", domain = states$mean_pollution, bins = bins)

# 5) Create hover labels
states <- states |>
  mutate(labels = str_c(str_to_title(ID),":" , mean_pollution, " micrograms per cubic meter"))
labels <- lapply(states$labels, HTML)

# 6) Create leaflet map
leaflet(states) |>
  setView(lng = -96, lat = 37.8, zoom = 4) |>
  addTiles() |>
  addPolygons(
    fillColor = ~pal(mean_pollution),
    weight = 2,
    opacity = 1,
    color = "black",
    dashArray = "12",
    fillOpacity = 0.7,
    highlightOptions = highlightOptions(
      weight = 5,
      color = "#666",
      dashArray = "",
      fillOpacity = 0.5,
      bringToFront = TRUE
    ),
    label = labels,
    labelOptions = labelOptions(
      style = list("font-weight" = "normal", padding = "3px 8px"),
      textsize = "15px",
      direction = "auto"
    )
  ) |>
  addLegend(
    pal = pal,
    values = ~mean_pollution,
    opacity = 0.7,
    title = "Pollution",
    position = "bottomright"
  )
```
Via the NHS ((National Institute on Minority Health and Health Disparities)) 
Source: [Link](https://hdpulse.nimhd.nih.gov/data-portal/physical/table?age=001&age_options=ageall_1&demo=234&demo_options=air_pollution_1&physicaltopic=002&physicaltopic_options=physical_2&race=00&race_options=raceall_1&sex=0&sex_options=sexboth_1&statefips=00&statefips_options=area_states)


**Risk of Wildfires by State:**
```{r, echo = FALSE, message=FALSE, warning=FALSE}

wildfire_clean <- wildfire_raw |>
  mutate(
    state_lower = tolower(State),
    fire_cat = cut(
      `Number of Wildfires`,
      breaks = c(-Inf, 500, 1500, 3000, Inf),
      labels = c("Low", "Medium", "High", "Very High")
    )
  )

state_fire <- wildfire_clean |>
  group_by(state_lower) |>
  summarize(category = first(fire_cat))  

states_sf <- st_as_sf(map("state", plot = FALSE, fill = TRUE))

state_plot <- states_sf |>
  left_join(state_fire, by = c("ID" = "state_lower"))

ggplot(data = state_plot) +
  geom_sf(aes(fill = category), color = "black", linetype = 1) +
  theme_void() +
  scale_fill_brewer(palette = "Reds", na.value = "grey80") +
  labs(fill = "Wildfire Risk")


```
Via the USDA (U.S Department of Agriculture)
Source: [Link](https://research.fs.usda.gov/firelab/products/dataandtools/wildfire-risk-communities?utm_source=chatgpt.com)


**Insight:**
This plot looks at each states risk of wildfires given previous data from 2023. This data takes the number of wildfires observed in 2023 and assigns them a categorical risk of either "Low", "Medium", "High, or "Very High" based on how many wildfires each state had. As shown the highest states are as expected (California, Texas, Washington, Oregon) due to them having large dry areas within there state. The lowest comes from the Midwest states and the upper New England area.


**Risk of Wildfires by State: Interactive**
```{r, echo = FALSE, message=FALSE, warning=FALSE}
states <- st_as_sf(map("state", plot = FALSE, fill = TRUE)) |>
  left_join(
    wildfire_clean |>
      group_by(state_lower) |>
      summarize(
        fire_cat = first(fire_cat),
        num_fires = first(`Number of Wildfires`)   # add number of wildfires
      ),
    by = c("ID" = "state_lower")
  )

#Colors for the map
pal <- colorFactor(
  palette = c(
  "Low" = "#A1D99B",      
  "Medium" = "#41AB5D",   
  "High" = "#FCAE91",    
  "Very High" = "#CB181D"
  ),
  domain = states$fire_cat
)

# Hover labels
states <- states |>
  mutate(labels = paste0(
    str_to_title(ID), "<br>",
    "Category: ", fire_cat, "<br>",
    "Number of Wildfires: ", num_fires
  ))

labels <- lapply(states$labels, HTML)

#Leaflet map
leaflet(states) |>
  setView(lng = -96, lat = 37.8, zoom = 4) |>
  addTiles() |>
  addPolygons(
    fillColor = ~pal(fire_cat),
    weight = 2,
    opacity = 1,
    color = "black",
    dashArray = "1",
    fillOpacity = 0.9,
    highlightOptions = highlightOptions(
      weight = 5,
      color = "#666",
      dashArray = "",
      fillOpacity = 0.75,
      bringToFront = TRUE
    ),
    label = labels,
    labelOptions = labelOptions(
      style = list("font-weight" = "normal", padding = "3px 8px"),
      textsize = "15px",
      direction = "auto"
    )
  ) |>
  addLegend(
    pal = pal,
    values = ~fire_cat,
    opacity = 0.7,
    title = "Wildfire Category",
    position = "bottomright"
  )
```
Via the USDA (U.S Department of Agriculture)
Source: [Link](https://research.fs.usda.gov/firelab/products/dataandtools/wildfire-risk-communities?utm_source=chatgpt.com)