---
title: "Mapping"
---

```{r, echo = FALSE}
library(maps)      
library(sf)        
library(dplyr)
library(leaflet)
library(readr)
library(stringr)
library(htmltools)
library(glue)
library(ggplot2)

# Load US states as sf object
states <- st_as_sf(maps::map("state", plot = FALSE, fill = TRUE))

polution_raw <- read_csv("pollutionDataSheet1.csv")
polution_raw


```

**Overview**
These choropleth maps use state level data to illustrate pollution (micrograms per cubic) and the  [BLANK]. The first dataset looks at air pollution and particulate matter by state in the year 2020.  

```{r, echo = FALSE}

polution_clean <- polution_raw |>
  mutate(state_lower = tolower(State))

state_aqi <- polution_clean |>
  group_by(state_lower) |>
  summarize(mean_value = mean(Pollution, na.rm = TRUE))

states_sf <- st_as_sf(map("state", plot = FALSE, fill = TRUE))

state_plot <- states_sf |>
  left_join(state_aqi, by = c("ID" = "state_lower"))

state_plot <- state_plot |>
  mutate(
    value_intervals = cut(
      mean_value,
      breaks = c(0, 4, 5, 6, 7, 8, 9, 10, 15),
      include.lowest = TRUE
    )
  )

ggplot(data = state_plot) +
  geom_sf(aes(fill = value_intervals), color = "white", linetype = 2) +
  theme_void() +
  scale_fill_brewer(palette = "PuBu", na.value = "grey80") +
  labs(fill = "Micrograms per cubic meter")
```
via the NIH (National Institute on Minority Health and Health Disparities)



**Insights:**
This plot shows the pollution trends across the continuous United States in the year 2020. The darker colors show states that are more polluted (higher micrograms per meter). While the lighter colors shows tates that are less polluted (lower micrograms per meter).


```{r, echo=FALSE}
states <- st_as_sf(map("state", plot = FALSE, fill = TRUE))

# 3) Join pollution data to states map
states <- states |>
  left_join(
    polution_clean |>
      group_by(state_lower) |>
      summarize(mean_pollution = mean(Pollution, na.rm = TRUE)),
    by = c("ID" = "state_lower")
  )

# 4) Create bins and color palette
bins <- c(0, 4, 5, 6, 7, 8, 9, 10, 15)  # adjust based on your data
pal <- colorBin("YlOrRd", domain = states$mean_pollution, bins = bins)

# 5) Create hover labels
states <- states |>
  mutate(labels = str_c(str_to_title(ID),":" , mean_pollution, " micrograms per cubic meter"))
labels <- lapply(states$labels, HTML)

# 6) Create leaflet map
leaflet(states) |>
  setView(lng = -96, lat = 37.8, zoom = 4) |>
  addTiles() |>
  addPolygons(
    fillColor = ~pal(mean_pollution),
    weight = 2,
    opacity = 1,
    color = "black",
    dashArray = "12",
    fillOpacity = 0.7,
    highlightOptions = highlightOptions(
      weight = 5,
      color = "#666",
      dashArray = "",
      fillOpacity = 0.5,
      bringToFront = TRUE
    ),
    label = labels,
    labelOptions = labelOptions(
      style = list("font-weight" = "normal", padding = "3px 8px"),
      textsize = "15px",
      direction = "auto"
    )
  ) |>
  addLegend(
    pal = pal,
    values = ~mean_pollution,
    opacity = 0.7,
    title = "Pollution",
    position = "bottomright"
  )
```
Via the NHS ((National Institute on Minority Health and Health Disparities))


**Insights:**
This plot is very similar to the plot above as it still shows the same pollution trends across the continuous United States. However the plot is now more interactive then the previous. By hovering over a particular state we can see what the actual micrograms per cubic meter value is. 





